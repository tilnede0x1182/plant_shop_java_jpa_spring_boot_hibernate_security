<!DOCTYPE html>
<html layout:decorate="~{fragments/base}" xmlns:th="http://www.thymeleaf.org"
	th:with="title='PlantShop | ' + ${plant.name}">

<head>
	<meta charset="UTF-8">
	<title th:text="'PlantShop | ' + ${plant.name}">PlantShop</title>
</head>

<div layout:fragment="content">
	<div class="container">
		<h1 class="mb-4">ðŸŒ± DÃ©tail de la plante</h1>

		<div class="card mb-4 shadow-sm">
			<div class="card-body">
				<h2 class="card-title" th:text="${plant.name}">Nom de la plante</h2>
				<p class="card-text" th:text="${plant.description}">Description</p>

				<ul class="list-group list-group-flush mb-3">
					<li class="list-group-item">
						<strong>CatÃ©gorie :</strong> <span th:text="${plant.category}">CatÃ©gorie</span>
					</li>
					<li class="list-group-item">
						<strong>Prix :</strong> <span th:text="${plant.price}">0.00</span> â‚¬
					</li>
					<li class="list-group-item">
						<strong>Stock disponible :</strong> <span th:text="${plant.stock}">0</span>
					</li>
				</ul>

				<div class="d-flex flex-wrap gap-2">
					<a href="/plants" class="btn btn-secondary">Retour Ã  la page d'acceuil</a>
					<button type="button" class="btn btn-success add-to-cart" th:data-id="${plant.id}"
						th:data-name="${plant.name}" th:data-price="${plant.price}">
						Ajouter au panier
					</button>
					<div th:if="${userRoleString == 'admin'}">
						<a href="@{'/admin/plants/' + ${plant.id} + '/edit'}" class="btn btn-warning add-to-cart">Modifier</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const load = () => JSON.parse(localStorage.getItem('cart') || '[]');
			const save = c => localStorage.setItem('cart', JSON.stringify(c));

			const btn = document.querySelector('.add-to-cart');
			if (btn) {
				btn.addEventListener('click', e => {
					e.preventDefault();
					const id = btn.dataset.id;
					const name = btn.dataset.name;
					const price = parseFloat(btn.dataset.price);

					const cart = load();
					const item = cart.find(i => i.id == id);
					item ? item.qty++ : cart.push({id, name, price, qty: 1});
					save(cart);
					refreshCart();
				});
			}
		});
	</script>
</div>

</html>
