<!-- templates/fragments/navbar.html -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 fixed-top"
     th:fragment="navbar"                         <!-- ← nom du fragment -->
     xmlns:th="http://www.thymeleaf.org">

  <div class="container">
    <a class="navbar-brand" href="/">🌿 PlantShop</a>

    <!-- burger -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">

      <ul class="navbar-nav me-auto"></ul> <!-- espace gauche -->

      <!-- on récupère la variable calculée dans GlobalUserTypeAdvice -->
      <ul class="navbar-nav"
          th:with="role=${userRole}, name=${#authentication.principal?.name}">

        <li th:if="${name}" class="navbar-text text-white me-2"
            th:text="${name}"></li>

        <li class="nav-item">
          <a class="nav-link" href="/cart">Panier
            (<span class="cart-count">0</span>)
          </a>
        </li>

        <!-- VISITEUR -->
        <li th:if="${role == 'visitor'}" class="nav-item">
          <a class="nav-link" href="/login">Connexion</a>
        </li>
        <li th:if="${role == 'visitor'}" class="nav-item">
          <a class="nav-link" href="/register">Inscription</a>
        </li>

        <!-- UTILISATEUR / ADMIN -->
        <li th:if="${role == 'user' || role == 'admin'}" class="nav-item">
          <a class="nav-link" href="/my_profile">Mon profil</a>
        </li>
        <li th:if="${role == 'user' || role == 'admin'}" class="nav-item">
          <a class="nav-link" href="/orders">Mes commandes</a>
        </li>

        <!-- ADMIN -->
        <li th:if="${role == 'admin'}" class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button"
             data-bs-toggle="dropdown">Admin</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/admin/plants">Gestion plantes</a></li>
            <li><a class="dropdown-item" href="/admin/users">Gestion utilisateurs</a></li>
          </ul>
        </li>

        <!-- Déconnexion -->
        <li th:if="${role == 'user' || role == 'admin'}" class="nav-item">
          <form th:action="@{/logout}" method="post">
            <button type="submit" class="nav-link btn btn-link">Déconnexion</button>
          </form>
        </li>
      </ul>
    </div>
  </div>
</nav>
